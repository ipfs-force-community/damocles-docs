<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Import existing sector data | Damocles</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/damocles-icon.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-C1545RTPE5"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-C1545RTPE5');</script>
    <meta name="description" content="Damocles, formerly known as Venus Power Service, is THE Filecoin storage power solution.">
    
    <link rel="preload" href="/assets/css/0.styles.e2ff4576.css" as="style"><link rel="preload" href="/assets/js/app.bdc4f3f1.js" as="script"><link rel="preload" href="/assets/js/2.2a8cf6e9.js" as="script"><link rel="preload" href="/assets/js/19.8f2f4079.js" as="script"><link rel="prefetch" href="/assets/js/10.41cee622.js"><link rel="prefetch" href="/assets/js/11.063d7fa2.js"><link rel="prefetch" href="/assets/js/12.b03ec269.js"><link rel="prefetch" href="/assets/js/13.9d2fb996.js"><link rel="prefetch" href="/assets/js/14.d1a07afe.js"><link rel="prefetch" href="/assets/js/15.d0fe8e34.js"><link rel="prefetch" href="/assets/js/16.0e1e653a.js"><link rel="prefetch" href="/assets/js/17.5738a6c0.js"><link rel="prefetch" href="/assets/js/18.dbf6fecb.js"><link rel="prefetch" href="/assets/js/20.ff5d3b81.js"><link rel="prefetch" href="/assets/js/21.92100b96.js"><link rel="prefetch" href="/assets/js/22.c53f7a6f.js"><link rel="prefetch" href="/assets/js/23.c337fce4.js"><link rel="prefetch" href="/assets/js/24.572f0463.js"><link rel="prefetch" href="/assets/js/25.a28053d9.js"><link rel="prefetch" href="/assets/js/26.09e654e2.js"><link rel="prefetch" href="/assets/js/27.0941c902.js"><link rel="prefetch" href="/assets/js/28.2a9152a4.js"><link rel="prefetch" href="/assets/js/29.c6546450.js"><link rel="prefetch" href="/assets/js/3.cc869a3b.js"><link rel="prefetch" href="/assets/js/30.368cfbe4.js"><link rel="prefetch" href="/assets/js/31.48183658.js"><link rel="prefetch" href="/assets/js/32.f58290a6.js"><link rel="prefetch" href="/assets/js/33.d3bcde1d.js"><link rel="prefetch" href="/assets/js/34.d80b161d.js"><link rel="prefetch" href="/assets/js/35.fdd8eea9.js"><link rel="prefetch" href="/assets/js/36.3c5b3643.js"><link rel="prefetch" href="/assets/js/37.2da98132.js"><link rel="prefetch" href="/assets/js/38.651574c5.js"><link rel="prefetch" href="/assets/js/39.265a9ebf.js"><link rel="prefetch" href="/assets/js/4.d4393beb.js"><link rel="prefetch" href="/assets/js/40.61f650d5.js"><link rel="prefetch" href="/assets/js/41.77fd1f96.js"><link rel="prefetch" href="/assets/js/42.82e1ede3.js"><link rel="prefetch" href="/assets/js/43.3b9e7325.js"><link rel="prefetch" href="/assets/js/44.e0139149.js"><link rel="prefetch" href="/assets/js/45.bd7f0265.js"><link rel="prefetch" href="/assets/js/46.db37718b.js"><link rel="prefetch" href="/assets/js/47.c5653ff1.js"><link rel="prefetch" href="/assets/js/48.26b1bd71.js"><link rel="prefetch" href="/assets/js/49.80000722.js"><link rel="prefetch" href="/assets/js/5.7af5716c.js"><link rel="prefetch" href="/assets/js/6.354469f3.js"><link rel="prefetch" href="/assets/js/7.d4b63fde.js"><link rel="prefetch" href="/assets/js/8.6f875c2d.js"><link rel="prefetch" href="/assets/js/9.ea6c973f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2ff4576.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/damocles-icon.png" alt="Damocles" class="logo"> <span class="site-name can-hide">Damocles</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">
  Deployment &amp; Operation
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/migrate-sectors.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/migrate-sectors.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">
  Deployment &amp; Operation
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/migrate-sectors.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/migrate-sectors.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/" aria-current="page" class="sidebar-link">Getting started</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Configurations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/damocles-manager-config.html" class="sidebar-link">damocles-manager config</a></li><li><a href="/operation/damocles-worker-config.html" class="sidebar-link">damocles-worker config</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Operations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/task-management.html" class="sidebar-link">Task management</a></li><li><a href="/operation/task-flow.html" class="sidebar-link">Task flow</a></li><li><a href="/operation/poster.html" class="sidebar-link">Dedicated PoSt node</a></li><li><a href="/operation/worker-util.html" class="sidebar-link">Worker utils</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Migration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/migrate-sectors.html" aria-current="page" class="active sidebar-link">Import existing sectors</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operation/migrate-sectors.html#import-and-verify" class="sidebar-link">Import and verify</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="import-existing-sector-data"><a href="#import-existing-sector-data" class="header-anchor">#</a> Import existing sector data</h1> <p>When one would like to migrate the sector storage directory sealed by other sealer solution to <code>damocles</code>, it needs to use <code>damocles-manager</code> to import and update the corresponding configuration file.</p> <h2 id="import-and-verify"><a href="#import-and-verify" class="header-anchor">#</a> Import and verify</h2> <p><strong>Note</strong>: Both import and validation need to be done without <code>damocles-manager daemon</code> being started.</p> <h3 id="import"><a href="#import" class="header-anchor">#</a> import</h3> <p><code>damocles-manager</code> provides an import tool called <code>storage attach</code>, which can be used as following:</p> <div class="language- extra-class"><pre class="language-text"><code>damocles-manager util storage attach --verbose --name={storage name} &lt;path&gt;
</code></pre></div><ul><li><code>name</code> is an optional parameter;</li> <li><code>&lt;path&gt;</code> is the storage path, which is converted to an absolute path during import.</li></ul> <p>For details of <code>name</code> and <code>&lt;path&gt;</code>, please refer to [Common.PersistStores](./04.damocles-manager-config.md
#commonpersiststores).</p> <p>For example, by using...</p> <div class="language- extra-class"><pre class="language-text"><code>damocles-manager util storage attach --verbose --name=a -v ./mock-tmp/remote
</code></pre></div><p>logs similar to the following would likely be produced:</p> <div class="language- extra-class"><pre class="language-text"><code>2022-03-11T16:03:52.492+0800 DEBUG policy policy/const.go:18 NETWORK SETUP {&quot;name&quot;: &quot;mainnet&quot;}
2022-03-11T16:03:52.493+0800 INFO cmd internal/util_storage.go:104 use match pattern &quot;/home/dtynn/proj/github.com/ipfs-force-community/venus-cluster/mock-tmp/remote /sealed/*&quot; {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false}
2022-03-11T16:03:52.493+0800 INFO cmd internal/util_storage.go:121 path &quot;s-t010000-16&quot; matched=true {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only &quot;: false}
2022-03-11T16:03:52.494+0800 INFO cmd internal/util_storage.go:121 path &quot;s-t010000-17&quot; matched=true {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only &quot;: false}
2022-03-11T16:03:52.494+0800 INFO cmd internal/util_storage.go:121 path &quot;s-t010000-18&quot; matched=true {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only &quot;: false}
2022-03-11T16:03:52.508+0800 INFO cmd internal/util_storage.go:148 sector indexer updated for s-t010000-16 {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false}
2022-03-11T16:03:52.509+0800 INFO cmd internal/util_storage.go:148 sector indexer updated for s-t010000-17 {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false}
2022-03-11T16:03:52.509+0800 INFO cmd internal/util_storage.go:148 sector indexer updated for s-t010000-18 {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false}
2022-03-11T16:03:52.509+0800 INFO cmd internal/util_storage.go:152 3 sectors out of 3 files have been updated {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false}
2022-03-11T16:03:52.509+0800 WARN cmd internal/util_storage.go:153 add the section below into the config file: {&quot;name&quot;: &quot;a&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false}

[[Common.PersistStores]]
Name = &quot;a&quot;
Path = &quot;/home/dtynn/proj/github.com/ipfs-force-community/damocles/mock-tmp/remote&quot;
Strict = false
ReadOnly = false
</code></pre></div><p>At this point, the directory import has been completed, and the location information of all sectors has also been recorded.
We can then complete the import by copying configuration in the output into the configuration file of <code>damocles-manager</code>.</p> <h4 id="reimport"><a href="#reimport" class="header-anchor">#</a> reimport</h4> <p>If we find that the information supplied during import is wrong, such as <code>--name</code> is misspelled, we can re-import with correct information to complete the import process.
The location information of the sector will be overwritten and updated.</p> <h4 id="separation-of-sealed-file-and-cache-dir"><a href="#separation-of-sealed-file-and-cache-dir" class="header-anchor">#</a> separation of sealed_file and cache_dir</h4> <p>Some sealer components allow <code>sealed_file</code> and <code>cache_dir</code> to be on different storage instances, in which case regular import may fail to locate sector files.
In this case, you can enable the split scan mode by adding the command line parameter <code>--allow-splitted</code>. In this mode, paths in the <code>sealed</code> folder and the <code>cache</code> folder that match the sector naming rules will be scanned separately.</p> <p>At this point, the log will look similar to:</p> <div class="language- extra-class"><pre class="language-text"><code>2022-04-19T19:11:55.137+0800 DEBUG policy policy/const.go:18 NETWORK SETUP {&quot;name&quot;: &quot;mainnet&quot;}
2022-04-19T19:11:55.154+0800 INFO cmd internal/util_storage.go:120 scan for sectors(upgrade=false) {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false , &quot;splitted&quot;: true}
2022-04-19T19:11:55.154+0800 INFO cmd internal/util_storage.go:211 0 sectors out of 0 files have been found {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false, &quot;splitted&quot;: true}
2022-04-19T19:11:55.154+0800 INFO cmd internal/util_storage.go:145 scan for splitted cache dirs(upgrade=false) {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot; : false, &quot;splitted&quot;: true}
2022-04-19T19:11:55.155+0800 INFO cmd internal/util_storage.go:211 3 sectors out of 3 files have been found {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false, &quot;splitted&quot;: true}
2022-04-19T19:11:55.156+0800 INFO cmd internal/util_storage.go:120 scan for sectors(upgrade=true) {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false , &quot;splitted&quot;: true}
2022-04-19T19:11:55.156+0800 INFO cmd internal/util_storage.go:211 0 sectors out of 0 files have been found {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false, &quot;splitted&quot;: true}
2022-04-19T19:11:55.156+0800 INFO cmd internal/util_storage.go:145 scan for splitted cache dirs(upgrade=true) {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot; : false, &quot;splitted&quot;: true}
2022-04-19T19:11:55.156+0800 INFO cmd internal/util_storage.go:211 0 sectors out of 0 files have been found {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false, &quot;splitted&quot;: true}
2022-04-19T19:11:55.156+0800 WARN cmd internal/util_storage.go:166 add the section below into the config file: {&quot;name&quot;: &quot;p3&quot;, &quot;strict&quot;: false, &quot;read-only&quot;: false, &quot;splitted&quot;: true}

[[Common.PersistStores]]
Name = &quot;p3&quot;
Path = &quot;/home/dtynn/proj/github.com/ipfs-force-community/damocles/
mock-tmp/pstore3&quot;
Strict = false
ReadOnly = false
</code></pre></div><p>Notes for using this mode:</p> <ul><li>There are no duplicate stored files due to storage exceptions in the target directory</li> <li>Sectors with only <code>cache_dir</code> and no corresponding <code>sealed_file</code> won't be located</li></ul> <h3 id="validation"><a href="#validation" class="header-anchor">#</a> Validation</h3> <p>The <code>storage find</code> tool provided by <code>damocles-manager</code> can be used to check whether the result of sector import is correct. It can be used as following:</p> <div class="language- extra-class"><pre class="language-text"><code>damocles-manager util storage find &lt;miner actor id&gt; &lt;sector number&gt;
</code></pre></div><p>Continuing with an example of the validation command demonstrated above, we want to verify that the sector <code>s-t010000-17</code> has been recorded correctly, we can use:</p> <div class="language- extra-class"><pre class="language-text"><code>damocles-manager util storage find 10000 17
</code></pre></div><p>Usually a log similar to the following would be produced:</p> <div class="language- extra-class"><pre class="language-text"><code>2022-04-19T19:13:15.235+0800 DEBUG policy policy/const.go:18 NETWORK SETUP {&quot;name&quot;: &quot;mainnet&quot;}
2022-04-19T19:13:15.249+0800 INFO cmd internal/util_storage.go:279 sector s-t010000-17 located, sealed file in &quot;a&quot;, cache dir in &quot;a&quot;
2022-04-19T19:13:15.249+0800 INFO cmd internal/util_storage.go:285 store instance exists {&quot;instance&quot;: &quot;a&quot;}
2022-04-19T19:13:15.249+0800 INFO cmd internal/util_storage.go:285 store instance exists {&quot;instance&quot;: &quot;a&quot;}
</code></pre></div><p>This means that our import and configuration work is complete.</p> <h4 id="validation-exception-sector-information-was-not-recorded-successfully"><a href="#validation-exception-sector-information-was-not-recorded-successfully" class="header-anchor">#</a> Validation exception: sector information was not recorded successfully</h4> <p>If you encounter something like the following during the verification process...</p> <div class="language- extra-class"><pre class="language-text"><code>2022-03-11T16:45:59.120+0800 WARN cmd internal/util_storage.go:214 s-t010000-17 not found
</code></pre></div><p>Such log indicates that the specified sector was not imported successfully, and we need to recheck the import process.</p> <h4 id="validation-exception-storage-configuration-not-updated"><a href="#validation-exception-storage-configuration-not-updated" class="header-anchor">#</a> Validation exception: Storage configuration not updated</h4> <p>If you encounter something like the following during the verification process...</p> <div class="language- extra-class"><pre class="language-text"><code>2022-03-11T16:22:34.044+0800 DEBUG policy policy/const.go:18 NETWORK SETUP {&quot;name&quot;: &quot;mainnet&quot;}
2022-03-11T16:22:34.059+0800 INFO cmd internal/util_storage.go:218 found s-t010000-17 in &quot;a&quot;
2022-03-11T16:22:34.059+0800 WARN cmd internal/util_storage.go:227 store instance not found, check your config file
</code></pre></div><p>Such a log indicates that the configuration file of <code>damocles-manager</code> has not been successfully updated, and we need to update the configuration according to the method mentioned above.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipfs-force-community/damocles-docs/edit/main/docs/operation/migrate-sectors.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/operation/worker-util.html" class="prev">
        Worker utils
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.bdc4f3f1.js" defer></script><script src="/assets/js/2.2a8cf6e9.js" defer></script><script src="/assets/js/19.8f2f4079.js" defer></script>
  </body>
</html>
