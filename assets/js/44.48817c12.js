(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{429:function(a,e,s){"use strict";s.r(e);var t=s(17),r=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"快速启用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速启用"}},[a._v("#")]),a._v(" 快速启用")]),a._v(" "),s("h2",{attrs:{id:"准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[a._v("#")]),a._v(" 准备工作")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("安装必要的第三方库。")]),a._v(" "),s("p",[a._v("这一部分可以参考 "),s("code",[a._v("lotus")]),a._v(" 文档中的相应部分 "),s("a",{attrs:{href:"https://lotus.filecoin.io/lotus/install/linux/#software-dependencies",target:"_blank",rel:"noopener noreferrer"}},[a._v("Software dependencies"),s("OutboundLink")],1),a._v("。")])]),a._v(" "),s("li",[s("p",[a._v("下载代码库")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("git clone https://github.com/ipfs-force-community/damocles.git\n")])])])]),a._v(" "),s("li",[s("p",[a._v("编译 "),s("code",[a._v("damocles")]),a._v(" 的组件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd damocles\nmake all\n")])])]),s("p",[a._v("完成后，在 "),s("code",[a._v("./dist/bin")]),a._v(" 目录下会有 "),s("code",[a._v("damocles-worker")]),a._v(" 和 "),s("code",[a._v("damocles-manager")]),a._v(" 两个可执行文件。")])]),a._v(" "),s("li",[s("p",[a._v("分发可执行文件到需要的机器上。")])]),a._v(" "),s("li",[s("p",[a._v("将 "),s("code",[a._v("./damocles-worker/create-cgroup.sh")]),a._v(" 分发到 "),s("code",[a._v("damocles-worker")]),a._v(" 所在的机器上，并以准备运行 "),s("code",[a._v("damocles-worker")]),a._v(" 的系统用户身份执行。")]),a._v(" "),s("p",[a._v("这会为这样的用户生成相应的 "),s("code",[a._v("cgroup")]),a._v(" 组，以便"),s("code",[a._v("damocles-worker")]),a._v(" 为其外部执行器进程分配硬件资源。")])])]),a._v(" "),s("h2",{attrs:{id:"生产模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生产模式"}},[a._v("#")]),a._v(" 生产模式")]),a._v(" "),s("h3",{attrs:{id:"damocles-manager"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#damocles-manager"}},[a._v("#")]),a._v(" damocles-manager")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("初始化工作目录")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./dist/bin/damocles-manager daemon init\n")])])])]),a._v(" "),s("li",[s("p",[a._v("按需配置默认配置文件 "),s("code",[a._v("~/.damocles-manager/sector-manager.cfg")])]),a._v(" "),s("p",[a._v("配置项、作用、配置方法可以参考文档 "),s("RouterLink",{attrs:{to:"/zh/operation/damocles-manager-config.html"}},[a._v("damocles-manager 的配置解析")]),a._v("。")],1)]),a._v(" "),s("li",[s("p",[a._v("创建矿工号（可选；如果已有，可略过此步骤）")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ ./damocles-manager util miner create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--from"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("OWNER_ADDRESS"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--owner"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("OWNER_ADDRESS"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--worker"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("WORKER_ADDRESS"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--sector-size"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("32GiB\n")])])]),s("p",[a._v("会得到如下返回值。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("miner actor: f0xxx9 (f2drcv6746m5ehwxxxxxy)\t   \n")])])]),s("p",[a._v("结果中的 "),s("code",[a._v("miner actor f0xxx9")]),a._v(" 就是创建的 miner id。")]),a._v(" "),s("blockquote",[s("p",[a._v("注意⚠️：--from 地址要保证有足够的余额，保证上链成功。")])])]),a._v(" "),s("li",[s("p",[a._v("启动 "),s("code",[a._v("damocles-manager")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./dist/bin/damocles-manager daemon run\n")])])]),s("blockquote",[s("p",[a._v("注意⚠️：如果要开启 winningPost，配置文件的"),s("code",[a._v("Miners.Proof.Enabled")]),a._v("字段和启动的 flag "),s("code",[a._v("--miner")]),a._v("需要同时设置为 true。要开启 windowPost 的话，配置文件的"),s("code",[a._v("Miners.PoSt.Enabled")]),a._v("和启动 flag "),s("code",[a._v("--poster")]),a._v("也需要同时设置为 true。")])])])]),a._v(" "),s("h3",{attrs:{id:"damocles-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#damocles-worker"}},[a._v("#")]),a._v(" damocles-worker")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("创建 "),s("code",[a._v("sealing_thread.location")]),a._v(" 父级目录，damocles-worker 在启动时会自动初始化每个 "),s("code",[a._v("sealing_thread.location")]),a._v(" 目录。")])]),a._v(" "),s("li",[s("p",[a._v("(可选) 下载计算参数文件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./dist/bin/damocles-manager util fetch-params 512MiB\n")])])])]),a._v(" "),s("li",[s("p",[a._v("(可选) "),s("RouterLink",{attrs:{to:"/zh/operation/hugeTLB.html#damocles-worker-pc1-hugetlb-pages-支持"}},[a._v("创建 NUMA 亲和的 hugepage 内存文件")])],1)]),a._v(" "),s("li",[s("p",[a._v("规划用于各阶段的 CPU 核、numa 区域等配置。")]),a._v(" "),s("p",[a._v("按需完成配置文件。")]),a._v(" "),s("p",[a._v("配置项、作用、配置方法可以参考文档 "),s("RouterLink",{attrs:{to:"/zh/operation/damocles-worker-config.html"}},[a._v("damocles-worker 的配置解析")]),a._v("。")],1)]),a._v(" "),s("li",[s("p",[a._v("启动 "),s("code",[a._v("damocles-worker")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./dist/bin/damocles-worker daemon -c /path/to/damocles-worker.toml\n")])])])])]),a._v(" "),s("h2",{attrs:{id:"mock-模式-开发人员使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mock-模式-开发人员使用"}},[a._v("#")]),a._v(" Mock 模式 (开发人员使用)")]),a._v(" "),s("p",[a._v("默认情况下，可以通过一系列命令在单机上启动一组 "),s("code",[a._v("mock")]),a._v(" 实例。")]),a._v(" "),s("h3",{attrs:{id:"damocles-manager-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#damocles-manager-2"}},[a._v("#")]),a._v(" damocles-manager")]),a._v(" "),s("p",[a._v("通过")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./dist/bin/damocles-manager mock --miner=10000 --sector-size=2KiB\n")])])]),s("p",[a._v("命令启动一个模拟为 Actor 为 "),s("code",[a._v("t010000")]),a._v("   的 "),s("code",[a._v("SP")]),a._v(" 分配 2KiB 扇区的 "),s("code",[a._v("damocles-manager")]),a._v(" 服务。")]),a._v(" "),s("p",[a._v("这一步骤也可以通过代码目录中的 "),s("code",[a._v("./mock/start_manager.sh")]),a._v(" 脚本完成。")]),a._v(" "),s("h3",{attrs:{id:"damocles-worker-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#damocles-worker-2"}},[a._v("#")]),a._v(" damocles-worker")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("创建并初始化本地存储，初始化远程存储")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./dist/bin/damocles-worker store sealing-init -l ./mock-tmp/store1 ./mock-tmp/store2 ./mock-tmp/store3\n./dist/bin/damocles-worker store file-init -l ./mock-tmp/remote\n")])])]),s("p",[a._v("这一步骤也可以通过代码目录中的 "),s("code",[a._v("./mock/cleanup_store.sh")]),a._v(" 脚本完成。")])]),a._v(" "),s("li",[s("p",[a._v("以 "),s("code",[a._v("mock")]),a._v(" 配置启动 "),s("code",[a._v("damocles-worker")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./dist/bin/damocles-worker daemon -c ./damocles-worker/assets/damocles-worker.mock.toml\n")])])]),s("p",[a._v("这一步骤也可以通过代码目录中的 "),s("code",[a._v("./mock/start_worker.sh")]),a._v(" 脚本完成。")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);