(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{387:function(e,t,n){"use strict";n.r(t);var a=n(17),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"damocles-worker-util-documentation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#damocles-worker-util-documentation"}},[e._v("#")]),e._v(" "),n("code",[e._v("damocles-worker-util")]),e._v(" documentation")]),e._v(" "),n("p",[n("code",[e._v("damocles-worker-util")]),e._v(" contains a set of "),n("code",[e._v("damocles-worker")]),e._v(" related utilities. These include:")]),e._v(" "),n("ul",[n("li",[e._v("hwinfo (Hardware information)")]),e._v(" "),n("li",[e._v("sealcalc (Sealing calculator)")])]),e._v(" "),n("h2",{attrs:{id:"hwinfo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hwinfo"}},[e._v("#")]),e._v(" hwinfo")]),e._v(" "),n("p",[n("code",[e._v("hwinfo")]),e._v(" displays hardware information so that we can configure "),n("code",[e._v("damocles-worker")]),e._v(" accordingly given the output of hardware information and use them more effectively.")]),e._v(" "),n("p",[e._v("The information currently available from hwinfo is as follows:")]),e._v(" "),n("ul",[n("li",[e._v("CPU topology (including the number of CPU cores, NUMA Memory Node, CPU Cache, etc.)")]),e._v(" "),n("li",[e._v("Disk information")]),e._v(" "),n("li",[e._v("GPU information")]),e._v(" "),n("li",[e._v("Memory information")])]),e._v(" "),n("p",[e._v("Parameter Description:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("damocles-worker-util-hwinfo\n// Display hardware information\n\nUSAGE:\n    damocles-worker-util hwinfo [OPTIONS]\n\nOPTIONS:\n        --full  // display full CPU topology information\n    -h, --help \t// print help information\n")])])]),n("h3",{attrs:{id:"hwinfo-dependency-installation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hwinfo-dependency-installation"}},[e._v("#")]),e._v(" hwinfo dependency installation")]),e._v(" "),n("ul",[n("li",[e._v("hwloc 2.x is used to get CPU topology information")]),e._v(" "),n("li",[e._v("OpenCL is used to get GPU information")])]),e._v(" "),n("h4",{attrs:{id:"hwloc-2-x-installation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hwloc-2-x-installation"}},[e._v("#")]),e._v(" hwloc 2.x installation")]),e._v(" "),n("h5",{attrs:{id:"on-ubuntu-20-04-or-later-it-can-be-installed-directly-using-apt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#on-ubuntu-20-04-or-later-it-can-be-installed-directly-using-apt"}},[e._v("#")]),e._v(" On Ubuntu 20.04 or later, it can be installed directly using "),n("code",[e._v("apt")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v(" apt install hwloc=2.\\*\n")])])]),n("h5",{attrs:{id:"source-installation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#source-installation"}},[e._v("#")]),e._v(" Source installation:")]),e._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Install necessary tools.")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -y "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" gcc\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Download hwloc-2.7.1.tar.gz")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" https://download.open-mpi.org/release/hwloc/v2.7/hwloc-2.7.1.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -zxpf hwloc-2.7.1.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" hwloc-2.7.1\n./configure --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/usr/local\n"),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" -j"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("nproc"),n("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\nldconfig /usr/local/lib\n")])])]),n("h4",{attrs:{id:"opencl-installation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#opencl-installation"}},[e._v("#")]),e._v(" OpenCL installation")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("apt install ocl-icd-opencl-dev\n")])])]),n("h3",{attrs:{id:"hwinfo-example"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hwinfo-example"}},[e._v("#")]),e._v(" hwinfo example")]),e._v(" "),n("p",[e._v("Example run on a machine with 2 32-core CPUs:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("damocles-worker-util hwinfo\n")])])]),n("p",[e._v("output:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("CPU topology:\nMachine (503.55 GiB)\n├── Package (251.57 GiB) (*** *** *** 32-Core Processor)\n│ ├── NUMANode (#0 251.57 GiB)\n│ ├── L3 (#0 16 MiB)\n│ │ └── PU #0 + PU #1 + PU #2 + PU #3\n│ ├── L3 (#1 16 MiB)\n│ │ └── PU #4 + PU #5 + PU #6 + PU #7\n│ ├── L3 (#2 16 MiB)\n│ │ └── PU #8 + PU #9 + PU #10 + PU #11\n│ ├── L3 (#3 16 MiB)\n│ │ └── PU #12 + PU #13 + PU #14 + PU #15\n│ ├── L3 (#4 16 MiB)\n│ │ └── PU #16 + PU #17 + PU #18 + PU #19\n│ ├── L3 (#5 16 MiB)\n│ │ └── PU #20 + PU #21 + PU #22 + PU #23\n│ ├── L3 (#6 16 MiB)\n│ │ └── PU #24 + PU #25 + PU #26 + PU #27\n│ └── L3 (#7 16 MiB)\n│ └── PU #28 + PU #29 + PU #30 + PU #31\n└── Package (251.98 GiB) (*** *** *** 32-Core Processor)\n    ├── NUMANode (#1 251.98 GiB)\n    ├── L3 (#8 16 MiB)\n    │ └── PU #32 + PU #33 + PU #34 + PU #35\n    ├── L3 (#9 16 MiB)\n    │ └── PU #36 + PU #37 + PU #38 + PU #39\n    ├── L3 (#10 16 MiB)\n    │ └── PU #40 + PU #41 + PU #42 + PU #43\n    ├── L3 (#11 16 MiB)\n    │ └── PU #44 + PU #45 + PU #46 + PU #47\n    ├── L3 (#12 16 MiB)\n    │ └── PU #48 + PU #49 + PU #50 + PU #51\n    ├── L3 (#13 16 MiB)\n    │ └── PU #52 + PU #53 + PU #54 + PU #55\n    ├── L3 (#14 16 MiB)\n    │ └── PU #56 + PU #57 + PU #58 + PU #59\n    └── L3 (#15 16 MiB)\n        └── PU #60 + PU #61 + PU #62 + PU #63\n\nDisks:\n╭───────────┬─────────────┬─────────────┬────────────┬───────────────────────────────────────╮\n│ Disk type │ Device name │ Mount point │ Filesystem │                 Space                 │\n├───────────┼─────────────┼─────────────┼────────────┼───────────────────────────────────────┤\n│ SSD       │ /dev/sda3   │ /           │ ext4       │ 346.87 GiB / 434.68 GiB (79.80% used) │\n├───────────┼─────────────┼─────────────┼────────────┼───────────────────────────────────────┤\n│ SSD       │ /dev/sda2   │ /boot       │ ext4       │ 675.00 MiB / 3.87 GiB (17.01% used)   │\n├───────────┼─────────────┼─────────────┼────────────┼───────────────────────────────────────┤\n│ SSD       │ /dev/md127  │ /mnt/mount  │ ext4       │ 4.83 TiB / 13.86 TiB (34.86% used)    │\n╰───────────┴─────────────┴─────────────┴────────────┴───────────────────────────────────────╯\n\nGPU:\n╭─────────────────────────┬────────┬───────────╮\n│           Name          │ Vendor │   Memory  │\n├─────────────────────────┼────────┼───────────┤\n│ NVIDIA GeForce RTX 3080 │ NVIDIA │ 9.78 GiB  │\n├─────────────────────────┼────────┼───────────┤\n│ NVIDIA GeForce RTX 3080 │ NVIDIA │ 9.78 GiB  │\n├─────────────────────────┼────────┼───────────┤\n│ NVIDIA GeForce RTX 3080 │ NVIDIA │ 9.78 GiB  │\n╰─────────────────────────┴────────┴───────────╯\n\n\n\nMemory:\n╭──────────────┬───────────────────┬────────────┬─────────────╮\n│ Total memory │    Used memory    │ Total swap │  Used swap  │\n├──────────────┼───────────────────┼────────────┼─────────────┤\n│ 515.63 GiB   │ 33.51 GiB (6.50%) │ 0 B        │ 0 B (0.00%) │\n╰──────────────┴───────────────────┴────────────┴─────────────╯\n\n")])])]),n("p",[e._v("From the output CPU topology information, this machine has two NUMANodes:")]),e._v(" "),n("ol",[n("li",[e._v("CPU set of NUMANode #0: 0-31")]),e._v(" "),n("li",[e._v("CPU set of NUMANode #1: 32-63")])]),e._v(" "),n("p",[e._v("We can modify the external "),n("code",[e._v("processor")]),e._v(" configuration group in the "),n("code",[e._v("damocles-worker")]),e._v(" configuration file ("),n("a",{attrs:{href:"1"}},[e._v("[[processors.{stage_name}]]")]),e._v(").")]),e._v(" "),n("p",[e._v("Through "),n("code",[e._v("cgroup.cpuset")]),e._v(" + "),n("code",[e._v("numa_preferred")]),e._v(" configuration items, the external "),n("code",[e._v("processor")]),e._v(" is restricted to only use the CPU in the specified NUMANode, and memory will also be allocated from the said NUMANode first, thereby improving the CPU efficiency ("),n("strong",[e._v("from  v0.5.0 or later, damocles "),n("a",{attrs:{href:"1"}},[e._v("supports loading NUMA-affinity hugepage memory files")]),e._v("; if this feature is enabled, cpuset can be allocated across NUMA nodes without performance impact")]),e._v(").")]),e._v(" "),n("p",[e._v("example:")]),e._v(" "),n("div",{staticClass:"language-toml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-toml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# damocles-worker.toml")]),e._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("processors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("stage_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[e._v("numa_preferred")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[e._v("cgroup.cpuset")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0-3"')]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ...")]),e._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("processors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("stage_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[e._v("numa_preferred")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[e._v("cgroup.cpuset")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"32-35"')]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ...")]),e._v("\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"sealcalc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sealcalc"}},[e._v("#")]),e._v(" sealcalc")]),e._v(" "),n("p",[e._v("Given fixed parameters, "),n("code",[e._v("sealcalc")]),e._v(" computes the running status of tasks in each stage during respective time period to maximize the sealing efficiency by adjusting the maximum concurrent number of tasks and "),n("code",[e._v("sealing_threads")]),e._v(".")]),e._v(" "),n("p",[e._v("Parameter Description:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("USAGE:\n    damocles-worker-util sealcalc [OPTIONS] --tree_d_mins <tree_d_mins> --tree_d_concurrent <tree_d_concurrent> --pc1_mins <pc1_mins> --pc1_concurrent <pc1_concurrent> --pc2_mins <pc2_mins> --pc2_concurrent <pc2_concurrent> --c2_mins <c2_mins > --c2_concurrent <c2_concurrent> --sealing_threads <sealing_threads>\n\nOPTIONS:\n        --c2_concurrent <c2_concurrent>                Specifies the maximum number of concurrent c2 tasks\n        --c2_mins <c2_mins>                            Specifies the time it takes to execute one c2 task, unit: minutes\n        --calculate_days <calculate_days>              Calculate the total duration, unit: days [default: 30]\n        --calculate_step_mins <calculate_step_mins>    Output step duration, unit: minutes [default: 60], if this value is 60, each line of results will be separated by 1 hour\n        --csv                                          Output results in csv format\n -h, --help                                            Print help information\n        --pc1_concurrent <pc1_concurrent>              Specifies the maximum number of concurrent pc1 tasks\n        --pc1_mins <pc1_mins>                          Specifies the time it takes to execute one pc1 task, unit: minutes\n        --pc2_concurrent <pc2_concurrent>              Specifies the maximum number of concurrent pc2 tasks\n        --pc2_mins <pc2_mins>                          Specifies the time it takes to execute one pc2 task, unit: minutes\n        --sealing_threads <sealing_threads>            Specify the number of sealing_threads\n        --seed_mins <seed_mins>                        Specifies the time to wait for the seed, unit: minutes [default: 80]\n        --tree_d_concurrent <tree_d_concurrent>        Specifies the maximum number of concurrent tree_d tasks\n        --tree_d_mins <tree_d_mins>                    Specify the time it takes to execute one tree_d task, unit: minutes\n")])])]),n("h3",{attrs:{id:"sealcalc-example"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sealcalc-example"}},[e._v("#")]),e._v(" sealcalc example:")]),e._v(" "),n("h4",{attrs:{id:"fixed-parameters"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fixed-parameters"}},[e._v("#")]),e._v(" Fixed parameters:")]),e._v(" "),n("ul",[n("li",[e._v("Time required for tree_d task execution: 10 minutes")]),e._v(" "),n("li",[e._v("Time required for pc1 task execution: 320 minutes")]),e._v(" "),n("li",[e._v("Time required for pc2 task execution: 25 minutes")]),e._v(" "),n("li",[e._v("Time required for c2 task execution: 18 minutes")])]),e._v(" "),n("h4",{attrs:{id:"adjustable-parameters"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#adjustable-parameters"}},[e._v("#")]),e._v(" Adjustable parameters:")]),e._v(" "),n("ul",[n("li",[e._v("sealing_threads number: 18")]),e._v(" "),n("li",[e._v("tree_d maximum concurrency: 2")]),e._v(" "),n("li",[e._v("pc1 maximum concurrency: 10")]),e._v(" "),n("li",[e._v("pc2 maximum concurrency: 5")]),e._v(" "),n("li",[e._v("c2 maximum concurrency: 2")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("damocles-worker-util sealcalc --tree_d_mins=10 --pc1_mins=320 --pc2_mins=1 --c2_mins=2 --tree_d_concurrent=2 --pc1_concurrent=10 --pc2_concurrent=5 --c2_concurrent=2 --sealing_threads= 18\n")])])]),n("p",[e._v("The output is as follows:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("┌sealing calculator─────────────────────────────────────────────────────┐\n│time    sealing    tree_d      pc1      pc2     wait    c2     finished│\n│(mins)  threads    (...)      (...)     (...)   seed   (...)   sectors │\n│                                                                       │\n│0       2/18        2/2       0/10       0/5      0     0/2      0     │\n│60      14/18       2/2       10/10      0/5      0     0/2      0     │\n│120     18/18       0/2       10/10      0/5      0     0/2      0     │\n│180     18/18       0/2       10/10      0/5      0     0/2      0     │\n│240     18/18       0/2       10/10      0/5      0     0/2      0     │\n│300     18/18       0/2       10/10      0/5      0     0/2      0     │\n│360     18/18       0/2       10/10      2/5      6     0/2      0     │\n│420     18/18       2/2       8/10       0/5      8     0/2      2     │\n│480     18/18       0/2       10/10      0/5      0     0/2      10    │\n│540     18/18       0/2       10/10      0/5      0     0/2      10    │\n│600     18/18       0/2       10/10      0/5      0     0/2      10    │\n│660     18/18       0/2       10/10      2/5      2     0/2      10    │\n│720     18/18       0/2       10/10      0/5      8     0/2      10    │\n│780     18/18       0/2       10/10      0/5      2     0/2      18    │\n│840     18/18       0/2       10/10      0/5      0     0/2      20    │\n│900     18/18       0/2       10/10      0/5      0     0/2      20    │\n│960     18/18       0/2       10/10      0/5      0     0/2      20    │\n│1020    18/18       0/2       10/10      0/5      8     0/2      20    │\n│1080    18/18       2/2       10/10      0/5      4     0/2      26    │\n│1140    18/18       0/2       10/10      0/5      2     0/2      28    │\n│1200    18/18       0/2       10/10      0/5      0     0/2      30    │\n│1260    18/18       0/2       10/10      0/5      0     0/2      30    │\n│1320    18/18       0/2       10/10      2/5      6     0/2      30    │\n│1380    18/18       2/2       10/10      0/5      6     0/2      32    │\n│1440    18/18       0/2       10/10      0/5      2     0/2      38    │\n│1500    18/18       0/2       10/10      0/5      0     0/2      40    │\n│1560    18/18       0/2       10/10      0/5      0     0/2      40    │\n│1620    18/18       0/2       10/10      2/5      2     0/2      40    │\n│1680    18/18       0/2       10/10      0/5      8     0/2      40    │\n│1740    18/18       0/2       10/10      0/5      2     0/2      48    │\n└───────────────────────────────────────────────────────────────────────┘\n\n")])])]),n("p",[n("em",[e._v("Arrow keys to turn pages")])]),e._v(" "),n("p",[e._v("Description of each column of the output result:")]),e._v(" "),n("ul",[n("li",[e._v("time (mins): time, unit: minutes. Each item of data output is the result of running within one step")]),e._v(" "),n("li",[e._v("sealing thread (running/total): sealing thread status (running thread/total thread)")]),e._v(" "),n("li",[e._v("tree_d (running/total): task status of tree_d stage (number of running tasks/total number of tasks)")]),e._v(" "),n("li",[e._v("pc1 (running/total): task status of pc1 stage (number of running tasks/total number of tasks)")]),e._v(" "),n("li",[e._v("pc2 (running/total): task status of pc2 stage (number of running tasks/total number of tasks)")]),e._v(" "),n("li",[e._v("wait seed: the number of tasks waiting for the seed")]),e._v(" "),n("li",[e._v("c2 (running/total): task status of c2 stage (number of running tasks/total number of tasks)")]),e._v(" "),n("li",[e._v("finish sector: the sector completed up to this step")])]),e._v(" "),n("p",[e._v("We can maximize the sealing efficiency by continuously adjusting the above-mentioned "),n("a",{attrs:{href:"1"}},[e._v("adjustable parameters")]),e._v(". These parameters can be used as a reference for the configuration of "),n("code",[e._v("damocles-worker")]),e._v(".")])])}),[],!1,null,null,null);t.default=s.exports}}]);