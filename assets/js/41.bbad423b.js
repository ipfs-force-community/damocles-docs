(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{411:function(a,e,t){"use strict";t.r(e);var s=t(17),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"扇区重建的支持"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#扇区重建的支持"}},[a._v("#")]),a._v(" 扇区重建的支持")]),a._v(" "),t("p",[a._v("当扇区数据所在的磁盘发生损坏或者其他原因导致扇区数据丢失时，可以通过扇区重建功能恢复扇区数据。")]),a._v(" "),t("h3",{attrs:{id:"基本原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本原理"}},[a._v("#")]),a._v(" 基本原理")]),a._v(" "),t("p",[t("code",[a._v("damocles-manager")]),a._v(" 中保存了扇区的 piece 文件信息和申请的随机数等信息。 扇区重建时 "),t("code",[a._v("damocles-manager")]),a._v(" 会下发这些信息给 "),t("code",[a._v("damocles-worker")]),a._v(", 再由 "),t("code",[a._v("damocles-worker")]),a._v(" 执行封装流程。")]),a._v(" "),t("p",[a._v("大致流程参考："),t("RouterLink",{attrs:{to:"/zh/operation/11.任务状态流转.html#重建-rebuild-任务的状态流转"}},[a._v("重建（rebuild）任务的状态流转")]),a._v("。")],1),a._v(" "),t("h3",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[a._v("#")]),a._v(" 准备工作")]),a._v(" "),t("h4",{attrs:{id:"_1-准备需要重建的扇区号和矿工号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备需要重建的扇区号和矿工号"}},[a._v("#")]),a._v(" 1. 准备需要重建的扇区号和矿工号")]),a._v(" "),t("h4",{attrs:{id:"_2-更改-damocles-worker-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-更改-damocles-worker-配置"}},[a._v("#")]),a._v(" 2. 更改 "),t("code",[a._v("damocles-worker")]),a._v(" 配置")]),a._v(" "),t("p",[a._v("有两种更改配置的方法:")]),a._v(" "),t("p",[a._v("第一种：更改 "),t("code",[a._v("damocles-worker")]),a._v(" 主配置文件，增加一个 plan 为 rebuild 的 sealing_thread, 或将原有的一个 sealing_thread 的 plan 更改为 rebuild。这种方式需要重启 "),t("code",[a._v("damocles-worker")]),a._v("。示例如下：")]),a._v(" "),t("div",{staticClass:"language-TOML extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# /path/to/your-damocles-worker-config.toml")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ...")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[a._v("sealing_thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[a._v("location")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/path/to/your_sealing_thread_location/"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[a._v("plan")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"rebuild"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ...")]),a._v("\n")])])]),t("p",[a._v("第二种：创建 sealing_thread 热更新配置文件。在 sealing_thread 的 location 目录下创建名为 "),t("code",[a._v("config.toml")]),a._v(" 的文件。文件内容如下:")]),a._v(" "),t("div",{staticClass:"language-TOML extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# /path/to/your_sealing_thread_location/config.toml")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[a._v("plan")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"rebuild"')]),a._v("\n")])])]),t("p",[t("code",[a._v("damocles-worker")]),a._v(" 会在扇区任务开始前加载热更新配置文件。具体参考: "),t("RouterLink",{attrs:{to:"/zh/operation/03.damocles-worker的配置解析.html#sealing_thread-配置热更新"}},[a._v("sealing_thread 配置热更新")])],1),a._v(" "),t("h4",{attrs:{id:"_3-检查-sealing-thread-状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-检查-sealing-thread-状态"}},[a._v("#")]),a._v(" 3. 检查 sealing_thread 状态")]),a._v(" "),t("p",[a._v("执行：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-worker worker -c your-config.toml list\n")])])]),t("p",[a._v("output:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('#0: "/path/to/your_sealing_thread_location"; plan=rebuild, sector_id=None, paused=false, paused_elapsed=None, state=Empty, last_err=None\n// ...\n')])])]),t("p",[a._v("或者执行：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-manager util worker info  <worker instance name or address>\n")])])]),t("p",[a._v("output:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("Index  Loc                                    Plan     SectorID       Paused  PausedElapsed  State      LastErr\n0      /path/to/your_sealing_thread_location  rebuild  NULL           false   NULL           Empty      NULL\n// ...\n")])])]),t("p",[a._v("如果显示 plan 为 rebuild 则说明配置改更成功。(注意: 热更新配置文件可能不会立刻生效，需要等待扇区任务重新开始才会加载它)")]),a._v(" "),t("h3",{attrs:{id:"开始重建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始重建"}},[a._v("#")]),a._v(" 开始重建")]),a._v(" "),t("h4",{attrs:{id:"_1-创建扇区重建任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建扇区重建任务"}},[a._v("#")]),a._v(" 1. 创建扇区重建任务")]),a._v(" "),t("p",[a._v("命令：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-manager util sealer sectors rebuild <miner actor> <sector number>\n")])])]),t("p",[a._v("其中 "),t("code",[a._v("<miner actor>")]),a._v(" 为矿工号， "),t("code",[a._v("<sector number>")]),a._v(" 为需要重建的扇区号。")]),a._v(" "),t("p",[a._v("我们以矿工号 1001, 需要重建的扇区号 123 为例。执行：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-manager util sealer sectors rebuild 1001 123\n")])])]),t("h4",{attrs:{id:"_2-观察-rebuild-的-sealing-thread-封装状态-等待重建完成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-观察-rebuild-的-sealing-thread-封装状态-等待重建完成"}},[a._v("#")]),a._v(" 2. 观察 rebuild 的 sealing_thread 封装状态, 等待重建完成")]),a._v(" "),t("p",[a._v("执行:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-worker worker -c your-config.toml list\n")])])]),t("p",[a._v("或者：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-manager util worker info  <worker instance name or address>\n")])])]),t("p",[a._v("观察 state 和 last_err 字段信息。 state 字段对应 "),t("RouterLink",{attrs:{to:"/zh/operation/11.任务状态流转.html#重建-rebuild-任务的状态流转"}},[a._v("重建（rebuild）任务的状态流转")]),a._v(" 中的 state。")],1),a._v(" "),t("p",[a._v("或者直接查看扇区状态信息：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("// 查询未完成的扇区\ndamocles-manager util sealer sectors state 1001 123\n\n// 查询完成的扇区\ndamocles-manager util sealer sectors state --offline 1001 123\n")])])]),t("h3",{attrs:{id:"其他相关命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他相关命令"}},[a._v("#")]),a._v(" 其他相关命令")]),a._v(" "),t("h4",{attrs:{id:"查询所有进行中的重建扇区的信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询所有进行中的重建扇区的信息"}},[a._v("#")]),a._v(" 查询所有进行中的重建扇区的信息")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-manager util sealer sectors list --rebuild --sealing=false\n")])])]),t("h4",{attrs:{id:"查询所有已完成的重建扇区的信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询所有已完成的重建扇区的信息"}},[a._v("#")]),a._v(" 查询所有已完成的重建扇区的信息")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("damocles-manager util sealer sectors list --offline --rebuild --sealing=false\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);